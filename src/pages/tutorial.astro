---
import Layout from '../layouts/Layout.astro';
import {SignedIn, SignedOut, SignInButton} from "@clerk/astro/components";
---
<Layout>
	<main class="max-w-6xl mx-auto px-6 pb-16 font-retro space-y-32">
		<section class="text-center relative bg-gradient-to-b from-nebula-black via-emerald-950 to-nebula-black py-20 rounded-lg shadow-inner">
			<img style="z-index: 0" src="/assets/img/logo.webp" alt="Starship Chronicle Logo" class="logo mx-auto w-48 h-48 mb-2 animate-grow [animation-timeline:scroll()]" />

			<h1 class="text-2xl md:text-4xl font-retro text-crt-green mb-6">Manual del Comandante</h1>


			<p class="text-white/70 font-doto text-sm md:text-xl max-w-3xl mx-auto mb-10 z-10">
				Tu nave est√° lista. La galaxia te espera. Aprende a dominar el universo de <strong>Starship Chronicle</strong> antes de lanzarte al hiperespacio.
			</p>
			<div class="absolute -bottom-10 left-1/2 transform -translate-x-1/2 flex flex-col animate-pulse z-40">
				<span class="animate-bounce text-crt-green text-2xl block">‚Üì</span>
				<small class="font-doto text-crt-green block">Scroll</small>
			</div>
		</section>

		<div class="trail-zone relative">
			<div class="background-trail -z-10">
				<img src="/assets/img/icons/ship-9.webp" alt="Nave scroll" class="ship" />
				<div class="trail-line"></div>
			</div>

			<!-- STEP 1 -->
			<section class="flex flex-col md:flex-row items-center gap-12 text-right">
				<img src="/assets/img/tutorial/scanner.webp" alt="Esc√°ner gal√°ctico" class="w-full md:w-1/2 rounded shadow-md mask-r-from-70% mask-r-to-100%" />
				<div class="md:w-1/2 space-y-4">

					<div class="flex items-center gap-3">
						<img class="w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-1.webp">
						<h2 class="text-xl md:text-2xl  text-crt-green">Escanea planetas cercanos</h2>
					</div>
					<p class="text-white/80 font-doto text-base">
						Empiezas sin planeta. Explora los sistemas accesibles con el combustible disponible. Cuanto m√°s lejos viajes, m√°s recompensas... y peligros.
					</p>
				</div>
			</section>

			<!-- STEP 2 -->
			<section class="flex flex-col md:flex-row-reverse items-center gap-12">
				<img loading="lazy" src="/assets/img/tutorial/events.webp" alt="Eventos de viaje" class="w-full md:w-1/2 rounded shadow-md mask-l-from-70% mask-l-to-100%" />
				<div class="md:w-1/2 space-y-4">
					<div class="flex items-center gap-3 order">
						<h2 class="text-xl md:text-2xl  text-crt-green">Viaja con riesgo calculado</h2>
						<img loading="lazy" class=" w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-2.webp">
					</div>
					<p class="text-white/80 font-doto text-base">
						Cada unidad de distancia consume combustible y activa un evento aleatorio: piratas, restos abandonados, tormentas‚Ä¶ ¬øEst√°s preparado para lo inesperado?
					</p>
				</div>
			</section>

			<!-- STEP 3 -->
			<section class="flex flex-col md:flex-row items-center gap-12 text-right">
				<img loading="lazy" src="/assets/img/tutorial/planet.webp" alt="Interacci√≥n en planetas" class="w-full md:w-1/2 rounded shadow-md  mask-r-from-70% mask-r-to-100%" />
				<div class="md:w-1/2 space-y-4">

					<div class="flex items-center gap-3">
						<img loading="lazy" class=" w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-3.webp">
						<h2 class="text-xl md:text-2xl  text-crt-green">Interact√∫a en los planetas</h2>
					</div>
					<p class="text-white/80 font-doto text-base">
						Repara tu nave, acepta misiones y comercia. Cada planeta tiene precios distintos y condiciones √∫nicas. Planea bien o te quedar√°s sin recursos.
					</p>
				</div>
			</section>

			<!-- STEP 4 -->
			<section class="flex flex-col md:flex-row-reverse items-center gap-12">
				<img loading="lazy" src="/assets/img/tutorial/missions.webp" alt="Misiones" class="w-full md:w-1/2 rounded shadow-md mask-l-from-70% mask-l-to-100%" />
				<div class="md:w-1/2 space-y-4">

					<div class="flex items-center gap-3">
						<h2 class="text-xl md:text-2xl  text-crt-green">Acepta encargos estelares</h2>
						<img loading="lazy" class=" w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-4.webp">
					</div>
					<p class="text-white/80 font-doto text-base">
						Transporta suministros, haz entregas encubiertas o acude a misiones de rescate. S√≥lo puedes llevar una a la vez. Elige bien tus prioridades.
					</p>
				</div>
			</section>

			<!-- STEP 5 -->
			<section class="flex flex-col md:flex-row items-center gap-12 text-right">
				<img loading="lazy" src="/assets/img/tutorial/combats.webp" alt="Combate" class="w-full md:w-1/2 rounded shadow-md mask-r-from-70% mask-r-to-100%" />
				<div class="md:w-1/2 space-y-4">
					<div class="flex items-center justify-end gap-3">
						<img loading="lazy" class=" w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-5.webp">
						<h2 class="text-xl md:text-2xl  text-crt-green">Combate o huye</h2>
					</div>
					<p class="text-white/80 font-doto text-base">
						Cuando un enemigo aparece, t√∫ decides: luchar con tus l√°seres o huir a cambio de perder casco. Un escudo activo puede salvarte en el momento justo.
					</p>
				</div>
			</section>

			<!-- STEP 6 -->
			<section class="flex flex-col md:flex-row-reverse items-center gap-12">
				<img loading="lazy" src="/assets/img/tutorial/victory.webp" alt="Victoria" class="w-full md:w-1/2 rounded shadow-md mask-l-from-70% mask-l-to-100%" />
				<div class="md:w-1/2 space-y-4">

					<div class="flex items-center gap-3">
						<h2 class="text-xl md:text-2xl  text-crt-green">Tu objetivo: ganar fama</h2>
						<img loading="lazy" class=" w-20 h-20 animate-[jiggle_2s_ease-in-out_infinite] planet" src="/assets/img/icons/planet-6.webp">
					</div>
					<p class="text-white/80 font-doto text-base">
						Cuando llegues a 6 puntos de Fama, habr√°s forjado tu leyenda como capit√°n estelar. Pero cuidado: el Renegado tambi√©n compite por el trono gal√°ctico.
					</p>
				</div>
			</section>

		</div>



		<!-- GAME LOG SECTION -->
		<section class="bg-nebula-black border border-crt-green/20 rounded-lg p-10 shadow-md font-doto">
			<h2 class="text-2xl text-crt-green text-center mb-8">
				<span class="animate-blink">></span>El Registro de Bit√°cora
			</h2>
			<div class="flex flex-col md:flex-row items-center gap-12">
				<img loading="lazy" src="/assets/img/tutorial/log.webp" alt="Log del juego" class="w-full md:w-1/2" />

				<div class="md:w-1/2 space-y-4 text-white/80">
					<p>
						Cada acci√≥n que tomas queda registrada. El <strong>Log</strong> te informa de:
					</p>
					<ul class="list-disc list-inside space-y-2 text-crt-green/90">
						<li>Resultados de combates y tiradas.</li>
						<li>Eventos durante los viajes.</li>
						<li>Mensajes de misiones y decisiones.</li>
						<li>Compras, ventas, da√±os y mejoras.</li>
					</ul>
					<p class="text-white/70 mt-4">
						Presta atenci√≥n al Log. No es solo un historial: <em>es tu br√∫jula narrativa</em>.
					</p>
				</div>
			</div>
		</section>

		<section class="relative bg-gradient-to-br via-emerald-950/20 from-green-950/50 to-nebula-black shadow-md font-doto min-h-[600px] flex justify-center items-end p-6 overflow-hidden">
			<img loading="lazy" id="crew" src="/assets/img/tutorial/crew.webp" class="absolute inset-0 w-full h-full object-cover object-center z-0" alt="Tripulaci√≥n" />
			<img loading="lazy" id="crew-bg" src="/assets/img/tutorial/crew-bg.webp" class="  blur-xs absolute inset-0 w-full h-full object-cover object-center -z-1" alt="Fondo Tripulaci√≥n" />


			<div class="relative z-10 p-6 text-center space-y-2 max-w-3xl mx-auto bg-emerald-950/60 backdrop-blur-sm">

				<p class="text-crt-green font-bold">¬øEst√°s listo para tomar el mando?</p>
				<p class="text-white/80 text-lg">
					Tu tripulaci√≥n aguarda, la galaxia es vasta, y tu leyenda apenas comienza.
				</p>

				<div class="flex flex-col sm:flex-row justify-center gap-6">
					<SignedOut>
						<SignInButton mode="modal"
									  class="cursor-pointer px-6 py-3 bg-crt-green text-black text-lg font-bold border border-crt-green hover:bg-transparent hover:text-crt-green transition">
							üöÄ Inicia Sesi√≥n
						</SignInButton>

						<a href="/demo"
						   class="px-6 py-3 bg-nebula-black text-crt-green border border-crt-green text-lg font-bold hover:bg-crt-green hover:text-black transition">
							üß™ Probar Demo
						</a>
					</SignedOut>
					<SignedIn>
						<a href="/juego"
						   class="px-6 py-3 bg-crt-green text-black text-lg font-bold border border-crt-green hover:bg-transparent hover:text-crt-green transition">
							üöÄ Jugar
						</a>
					</SignedIn>
				</div>
			</div>
		</section>



		<div class="text-center">
			<a href="/" class="px-6 py-2 border border-crt-green text-crt-green font-doto hover:bg-crt-green hover:text-black transition cursor-crosshair">
				‚Üê Volver al inicio
			</a>
		</div>
	</main>
</Layout>


<style>
	.background-trail {
		position: fixed;
		top: 0;
		left: 50%;
		transform: translateX(-50%);
		width: 100px;
		z-index: -1;
		pointer-events: none;
		opacity: 0; /* Oculto inicialmente */
		filter: blur(12px);
		transition: opacity 0.4s ease, filter 0.4s ease;
	}


	.ship {
		position: relative;
		width: 100px;
		z-index: -10;
		transform-origin: center center;

	}

	.trail-line {
		position: absolute;
		top: 0;
		left: 50%;
		width: 4px;
		height: 100px;
		background: #00ff7f;
		opacity: 0.2;
		transform: translateX(-50%) scaleY(1);
		transform-origin: top center;
		filter: blur(5px);
	}


</style>


<script>
	import gsap from 'gsap'
	import { ScrollTrigger } from 'gsap/ScrollTrigger'
	import { MotionPathPlugin } from 'gsap/MotionPathPlugin'

	gsap.registerPlugin(ScrollTrigger, MotionPathPlugin)

	const path = {
		path: [
			{ x: -40, y: 0 },
			{ x: 40, y: 120 },
			{ x: -40, y: 240 },
			{ x: 40, y: 360 },
			{ x: -40, y: 480 },
			{ x: 40, y: 600 },
			{ x: -40, y: 680 },
			{ x: 0, y: 780 },

		],
		curviness: 1.2
	}
	export function initTrailAnimation() {
		const ship = document.querySelector('.ship')
		const trail = document.querySelector('.trail-line')
		const container = document.querySelector('.background-trail')
		if (!ship || !trail || !container) return

		ScrollTrigger.create({
			trigger: '.trail-zone',
			start: 'top center',
			end: 'bottom center',
			onEnter: () => {
				gsap.to(container, {
					opacity: 1,
					y: 0,
					filter: 'blur(0px)',
					duration: 0.6,
					ease: 'power2.out'
				});
			},
			onLeave: () => {
				gsap.to(container, {
					opacity: 0,
					y: -40,
					filter: 'blur(6px)',
					duration: 0.6,
					ease: 'power2.out'
				});
			},
			onEnterBack: () => {
				gsap.to(container, {
					opacity: 1,
					y: 0,
					filter: 'blur(0px)',
					duration: 0.6,
					ease: 'power2.out'
				});
			},
			onLeaveBack: () => {
				gsap.to(container, {
					opacity: 0,
					y: -40,
					filter: 'blur(6px)',
					duration: 0.6,
					ease: 'power2.out'
				});
			}
		});



		gsap.to(ship, {
			motionPath: {
				path: path.path,
				autoRotate: false
			},
			keyframes: [
				{ rotation: -15 },
				{ rotation: 15 },
				{ rotation: -15 },
				{ rotation: 15 },
				{ rotation: -15 },
				{ rotation: 15 },
				{ rotation: -15 }
			],
			ease: "none",
			scrollTrigger: {
				trigger: ".trail-zone",
				start: "top center",
				end: "bottom bottom",
				scrub: true
			}
		})


		gsap.to(trail, {
			scaleY: 8,
			transformOrigin: "top center",
			ease: "none",
			scrollTrigger: {
				trigger: ".trail-zone",
				start: "top center",
				end: "bottom bottom",
				scrub: true
			}
		})
	}


	export function initCrewAnimation() {
		const crewImage = document.getElementById('crew');
		const crewBgImage = document.getElementById('crew-bg');

		if (!crewImage || ! crewBgImage) return;

		gsap.fromTo(crewImage,
			{
				scale: .9,
			},
			{
				scale: 1.1,
				duration: 2,
				ease: "power2.out",
				scrollTrigger: {
					trigger: crewImage,
					start: "top 100%",
					end: "top 0%",
					scrub: true,
					toggleActions: "play reverse play reverse",
				}
			});

		gsap.fromTo(crewBgImage,
			{
				scale: 1.1,
			},
			{
				scale: 1,
				duration: 2,
				ease: "power2.out",
				scrollTrigger: {
					trigger: crewImage,
					start: "top 100%",
					end: "top 0%",
					scrub: true,
					toggleActions: "play reverse play reverse",
				}
			});
	}

	initCrewAnimation()
	initTrailAnimation();

</script>
